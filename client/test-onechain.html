<!DOCTYPE html>
<html>
<head>
    <title>OneChain Wallet Test</title>
</head>
<body>
    <h1>OneChain Wallet Transaction Test</h1>
    <button id="testBtn">Test Transaction Format</button>
    <pre id="output"></pre>

    <script type="module">
        import { Transaction } from '@mysten/sui/transactions';
        import { TransactionBlock } from '@mysten/sui.js/transactions';

        const output = document.getElementById('output');
        
        document.getElementById('testBtn').addEventListener('click', async () => {
            try {
                output.textContent = 'Testing...\n';
                
                // Check wallet
                if (!window.onechain?.sui) {
                    output.textContent += 'ERROR: OneChain wallet not found!\n';
                    return;
                }
                
                const wallet = window.onechain.sui;
                output.textContent += 'Wallet found!\n';
                
                // Connect
                await wallet.connect();
                const accounts = await wallet.getAccounts();
                output.textContent += `Connected: ${accounts[0]}\n\n`;
                
                // Test Transaction class
                output.textContent += '=== Testing Transaction (from @mysten/sui) ===\n';
                const tx1 = new Transaction();
                output.textContent += `Type: ${tx1.constructor.name}\n`;
                output.textContent += `Has toJSON: ${typeof tx1.toJSON}\n`;
                output.textContent += `Prototype: ${Object.getPrototypeOf(tx1).constructor.name}\n\n`;
                
                // Test TransactionBlock class
                output.textContent += '=== Testing TransactionBlock (from @mysten/sui.js) ===\n';
                const tx2 = new TransactionBlock();
                output.textContent += `Type: ${tx2.constructor.name}\n`;
                output.textContent += `Has toJSON: ${typeof tx2.toJSON}\n`;
                output.textContent += `Prototype: ${Object.getPrototypeOf(tx2).constructor.name}\n\n`;
                
                // Check what wallet expects
                output.textContent += '=== Checking Wallet Methods ===\n';
                output.textContent += `signTransactionBlock: ${typeof wallet.signTransactionBlock}\n`;
                output.textContent += `signAndExecuteTransactionBlock: ${typeof wallet.signAndExecuteTransactionBlock}\n`;
                
                output.textContent += '\n=== Test Complete ===\n';
                output.textContent += 'Check console for more details';
                
                console.log('Transaction object:', tx1);
                console.log('TransactionBlock object:', tx2);
                console.log('Wallet:', wallet);
                
            } catch (error) {
                output.textContent += `\nERROR: ${error.message}\n`;
                console.error(error);
            }
        });
    </script>
</body>
</html>
